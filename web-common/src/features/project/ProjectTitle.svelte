<script lang="ts">
  import Spacer from "@rilldata/web-common/components/icons/Spacer.svelte";
  import Tooltip from "@rilldata/web-common/components/tooltip/Tooltip.svelte";
  import TooltipContent from "@rilldata/web-common/components/tooltip/TooltipContent.svelte";
  import { shorthandTitle } from "@rilldata/web-common/features/project/shorthand-title/index.js";
  import { runtime } from "@rilldata/web-common/runtime-client/runtime-store";
  import { onMount } from "svelte";
  import { useProjectTitle } from "./selectors";

  $: projectTitle = useProjectTitle($runtime.instanceId);

  let mounted = false;
  onMount(() => {
    mounted = true;
  });
</script>

<header
  class="sticky top-0 grid align-center bg-white z-50"
  style:height="var(--header-height)"
>
  <!-- the pl-[.875rem] is a fix to move this new element over a pinch.-->
  <h1
    class="grid grid-flow-col justify-start gap-x-3 p-4 pl-[.75rem] items-center content-center"
  >
    {#if mounted && $projectTitle.isSuccess}
      <a href="/dataos-basepath/">
        <div
          style:width="20px"
          style:font-size="9px"
          class="grid place-items-center rounded bg-gray-800 text-white font-normal"
          style:height="20px"
        >
          <div>
            {shorthandTitle($projectTitle.data || "Ri")}
          </div>
        </div>
      </a>
    {:else}
      <Spacer size="16px" />
    {/if}
    <Tooltip distance={8}>
      <a
        class="font-semibold text-black grow text-ellipsis overflow-hidden whitespace-nowrap pr-12"
        href="/dataos-basepath/"
      >
        {$projectTitle.data || "Untitled Project"}
      </a>
      <TooltipContent maxWidth="300px" slot="tooltip-content">
        <div class="font-bold">
          {$projectTitle.data || "Untitled Project"}
        </div>
      </TooltipContent>
    </Tooltip>
  </h1>
</header>
